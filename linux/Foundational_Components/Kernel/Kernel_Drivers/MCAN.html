

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.2.2.5. MCAN &mdash; Processor SDK Linux for J721e Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="Processor SDK Linux for J721e Documentation" href="../../../../index.html"/>
        <link rel="up" title="3.2.2. Kernel Drivers" href="../../../Foundational_Components_Kernel_Drivers.html"/>
        <link rel="next" title="3.2.2.6. DSS" href="Display/DSS7.html"/>
        <link rel="prev" title="3.2.2.4. Crypto" href="Crypto.html"/> 
  <script src="https://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../../../../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../devices/J7_Family/linux/index.html" class="icon icon-home"> Processor SDK Linux for J721e
          

          
          </a>

          
            
            
              <div class="version">
                09_00_00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../Overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devices/J7_Family/linux/Release_Specific.html">2. Release Specific</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../Foundational_Components.html">3. Foundational Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_U-Boot.html">3.1. U-Boot</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../Foundational_Components_Kernel.html">3.2. Kernel</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../Foundational_Components_Kernel_Users_Guide.html">3.2.1. Users Guide</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../../Foundational_Components_Kernel_Drivers.html">3.2.2. Kernel Drivers</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="ADC.html">3.2.2.1. ADC</a></li>
<li class="toctree-l4"><a class="reference internal" href="Audio.html">3.2.2.2. Audio</a></li>
<li class="toctree-l4"><a class="reference internal" href="Camera/CSI2RX.html">3.2.2.3. CSI2RX</a></li>
<li class="toctree-l4"><a class="reference internal" href="Crypto.html">3.2.2.4. Crypto</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">3.2.2.5. MCAN</a></li>
<li class="toctree-l4"><a class="reference internal" href="Display/DSS7.html">3.2.2.6. DSS</a></li>
<li class="toctree-l4"><a class="reference internal" href="GPIO.html">3.2.2.7. GPIO</a></li>
<li class="toctree-l4"><a class="reference internal" href="HYPERFLASH.html">3.2.2.8. HyperBus and HyperFlash</a></li>
<li class="toctree-l4"><a class="reference internal" href="I2C.html">3.2.2.9. I2C</a></li>
<li class="toctree-l4"><a class="reference internal" href="Network/CPSW-Ethernet.html">3.2.2.10. CPSW Ethernet</a></li>
<li class="toctree-l4"><a class="reference internal" href="PCIe/PCIe_End_Point.html">3.2.2.11. PCIe End Point</a></li>
<li class="toctree-l4"><a class="reference internal" href="PCIe/PCIe_Backplane.html">3.2.2.12. PCIe Backplane</a></li>
<li class="toctree-l4"><a class="reference internal" href="PCIe/PCIe_Root_Complex.html">3.2.2.13. PCIe Root Complex</a></li>
<li class="toctree-l4"><a class="reference internal" href="PMIC/pmic_tps6594.html">3.2.2.14. TPS6594 PMIC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Foundational_Components_Kernel_Drivers_Power_Management.html">3.2.2.15. Power Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="QSPI.html">3.2.2.16. OSPI/QSPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="SERDES/SERDES.html">3.2.2.17. SERDES</a></li>
<li class="toctree-l4"><a class="reference internal" href="SPI.html">3.2.2.18. SPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="Storage/NAND.html">3.2.2.19. NAND</a></li>
<li class="toctree-l4"><a class="reference internal" href="Storage/MMC-SD.html">3.2.2.20. MMC/SD</a></li>
<li class="toctree-l4"><a class="reference internal" href="UART.html">3.2.2.21. UART</a></li>
<li class="toctree-l4"><a class="reference internal" href="UFS.html">3.2.2.22. UFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="USB/CDNS3.html">3.2.2.23. USB</a></li>
<li class="toctree-l4"><a class="reference internal" href="VTM.html">3.2.2.24. Voltage &amp; Thermal Management (VTM)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../Foundational_Components_Kernel_LTP-DDT_Validation.html">3.2.3. LTP-DDT Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Foundational_Components_Kernel_FAQs.html">3.2.4. FAQs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_Filesystem.html">3.3. Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_Tools.html">3.4. Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_IPC_J721E.html">3.5. IPC for J721E</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_Graphics.html">3.6. Graphics and Display</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_Multimedia_D5520_VXE384.html">3.7. Multimedia Video Codec</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_Virtualization.html">3.8. Virtualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_ATF.html">3.9. ARM Trusted Firmware-A</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Foundational_Components_OPTEE.html">3.10. OP-TEE</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../How_to_Guides.html">4. How to Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Documentation_Tarball.html">5. Documentation Tarball</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../devices/J7_Family/linux/index.html">Processor SDK Linux for J721e</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../devices/J7_Family/linux/index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../Foundational_Components.html"><span class="section-number">3. </span>Foundational Components</a> &raquo;</li>
      
          <li><a href="../../../Foundational_Components_Kernel.html"><span class="section-number">3.2. </span>Kernel</a> &raquo;</li>
      
          <li><a href="../../../Foundational_Components_Kernel_Drivers.html"><span class="section-number">3.2.2. </span>Kernel Drivers</a> &raquo;</li>
      
    <li><span class="section-number">3.2.2.5. </span>MCAN</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mcan">
<span id="id1"></span><h1><span class="section-number">3.2.2.5. </span>MCAN<a class="headerlink" href="#mcan" title="Permalink to this headline">¶</a></h1>
<p class="rubric" id="introduction"><strong>Introduction</strong></p>
<p>The Controller Area Network is a serial communications protocol which
efficiently supports distributed real-time control with a high level of
security. The MCAN module supports bitrates up to 5 Mbit/s and is
compliant to the ISO 11898-1:2015. The core IP within M_CAN is provided
by Bosch.</p>
<p>This wiki page provides usage information of M_CAN Linux driver.</p>
<p class="rubric" id="setup-details"><strong>Setup Details</strong></p>
<p class="rubric" id="ti-board-list"><strong>TI board List</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 12%" />
<col style="width: 11%" />
<col style="width: 28%" />
<col style="width: 23%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>SoC</p></th>
<th class="head"><p>Board</p></th>
<th class="head"><p>Number of Instances</p></th>
<th class="head"><p>Connection Type</p></th>
<th class="head"><p>Enabled by default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Dra76x</p></td>
<td><p>EVM</p></td>
<td><p>1</p></td>
<td><p>Header</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>AM654x</p></td>
<td><p>IDK</p></td>
<td><p>2</p></td>
<td><p>DB9</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>AM64x</p></td>
<td><p>EVM</p></td>
<td><p>2</p></td>
<td><p>Header</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>J721E</p></td>
<td><p>EVM</p></td>
<td><p>4</p></td>
<td><p>Header</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>J721S2</p></td>
<td><p>EVM</p></td>
<td><p>5</p></td>
<td><p>Header</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>AM62x</p></td>
<td><p>SK</p></td>
<td><p>3</p></td>
<td><p>Header</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>Table:  Boards M_CAN Driver is Validated on</p>
<p class="rubric" id="connection-configuration"><strong>Connection Configuration</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 47%" />
<col style="width: 53%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="center"><div
class="thumb tnone"><div
class="thumbinner"
style="width:302px;"><img alt="../../../../_images/mcan-diagram-evm-to-evm.png" src="../../../../_images/mcan-diagram-evm-to-evm.png" />
<div
class="thumbcaption"><div class="magnify"></td>
<td><div class="center"><div
class="thumb tnone"><div
class="thumbinner"
style="width:302px;"><img alt="../../../../_images/Dcan_header_to_db9.png" src="../../../../_images/Dcan_header_to_db9.png" />
<div
class="thumbcaption"><div class="magnify"></td>
</tr>
<tr class="row-even"><td><p>Header to Header</p></td>
<td><p>Header to DB9</p></td>
</tr>
</tbody>
</table>
<p>Table:  Various DCAN EVM Connection Configuration</p>
<p class="rubric" id="equipment"><strong>Equipment</strong></p>
<p class="rubric" id="female-db9-cable"><strong>Female DB9 Cable</strong></p>
<p>For boards exposing M_CAN using male DB9 connectors, a female connector
is required. The other side can be male or female depending on the other
CAN device the user connects to.</p>
<a class="reference internal image-reference" href="../../../../_images/DB9_cable.jpg"><img alt="../../../../_images/DB9_cable.jpg" class="align-center" src="../../../../_images/DB9_cable.jpg" style="width: 300.0px; height: 300.0px;" /></a>
<p class="rubric" id="jumper-wires"><strong>Jumper Wires</strong></p>
<p>For boards where the CAN pins are broken out via a header, female jumper
cables will be ideal for connection. The CAN pins will be CAN H
(typically pin 1 of the header), GND (middle pin of the header) and CAN
L (lowest pin on the header). The pinout in the header might vary across
different boards and users must consult the board’s schematic to verify
this.</p>
<a class="reference internal image-reference" href="../../../../_images/Female_to_female_jumper.png"><img alt="../../../../_images/Female_to_female_jumper.png" class="align-center" src="../../../../_images/Female_to_female_jumper.png" style="width: 367.20000000000005px; height: 347.40000000000003px;" /></a>
<p class="rubric" id="custom-db9-to-header-cable"><strong>Custom DB9 to Header Cable</strong></p>
<p>Typically CAN devices use a DB9 connection therefore for boards whose
CAN pins are broken out via a header it is helpful to create a header to
DB9 connector cable. This custom cable is simple to make. Either a male
or female DB9 connector (not cable) must be obtained along with three
female jumper wires.</p>
<p>Snip one end of each of the jumper wires and expose some of the wiring.
Now solder each of the exposed wires to pin 7 (CAN H), pin 2 (CAN L) and
pin 3 (GND). Make sure your soldering on the side of the DB9 that has
the metal lip meant to push some of the exposed wire into and soldering
to the correct pins correctly. Use the below diagram as a reference.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 56%" />
<col style="width: 44%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="center"><div class="floatnone"><img alt="../../../../_images/DCAN_custom_cable_diagram.png" src="../../../../_images/DCAN_custom_cable_diagram.png" />
</div></div></td>
<td><div class="center"><div class="floatnone"><img alt="../../../../_images/Custom_cable.png" src="../../../../_images/Custom_cable.png" />
</div></div></td>
</tr>
<tr class="row-even"><td><p>Wiring Diagram</p></td>
<td><p>Example of completed cable.</p></td>
</tr>
</tbody>
</table>
<p class="rubric" id="can-utilities"><strong>CAN Utilities</strong></p>
<p>There may be other userspace applications that can be used to interact
with the CAN bus but the SDK supports using Canutils which is already
included in the sdk filesystem.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These instructions are for can0 (first and perhaps only CAN instance
enabled). If the board has multiple CAN instances enabled then they can
be referenced by incrementing the CAN instance number. For example 2 CAN
instances will have can0 and can1.</p>
</div>
<p class="rubric" id="quick-steps"><strong>Quick Steps</strong></p>
<p class="rubric" id="initialize-can-bus"><strong>Initialize CAN Bus</strong></p>
<ul class="simple">
<li><p>Set bitrate</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ ip link set can0 type can bitrate 1000000
</pre></div>
</div>
<ul class="simple">
<li><p>CAN-FD mode</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ ip link set can0 type can bitrate 1000000 fd on
</pre></div>
</div>
<ul class="simple">
<li><p>CAN-FD mode with bitrate switching</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ ip link set can0 type can bitrate 1000000 dbitrate 4000000 fd on
</pre></div>
</div>
<p class="rubric" id="start-can-bus"><strong>Start CAN Bus</strong></p>
<ul class="simple">
<li><p>Device bring up</p></li>
</ul>
<p>Bring up the device using the command:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ ip link set can0 up
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric" id="transfer-packets"><strong>Transfer Packets</strong></p>
<p class="rubric" id="cansend"><strong>Cansend</strong></p>
<p>Used to generate a specific can frame. The syntax for cansend is as
follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;can_id&gt;#{R|data}          for CAN 2.0 frames
&lt;can_id&gt;##&lt;flags&gt;{data}    for CAN FD frames
</pre></div>
</div>
<p>Some examples:</p>
<ol class="loweralpha simple">
<li><p>Send CAN 2.0 frame</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ cansend can0 123#DEADBEEF
</pre></div>
</div>
<ol class="loweralpha simple" start="2">
<li><p>Send CAN FD frame</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ cansend can0 113##2AAAAAAAA
</pre></div>
</div>
<ol class="loweralpha simple" start="3">
<li><p>Send CAN FD frame with BRS</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ cansend can0 143##1AAAAAAAAA
</pre></div>
</div>
<p class="rubric" id="cangen"><strong>Cangen</strong></p>
<p>Used to generate frames at equal intervals. The syntax for cangen is as
follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cangen [options] &lt;CAN interface&gt;
</pre></div>
</div>
<p>Some examples:</p>
<ol class="loweralpha simple">
<li><p>Full load test with polling, 10 ms timeout</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ cangen can0 -g 0 -p 10 -x
</pre></div>
</div>
<p>b. fixed CAN ID and length, inc. data, canfd frames with bitrate
switching</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ cangen vcan0 -g 4 -I 42A -L 1 -D i -v -v -f -b
</pre></div>
</div>
<p class="rubric" id="candump"><strong>Candump</strong></p>
<p>Candump is used to display received frames.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>candump [options] &lt;CAN interface&gt;
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ candump can0
</pre></div>
</div>
<p>Note: Use Ctrl-C to terminate candump</p>
<p>Further options for all canutils commands are available at
<a class="reference external" href="https://git.pengutronix.de/cgit/tools/canutils">https://git.pengutronix.de/cgit/tools/canutils</a></p>
<p class="rubric" id="stop-can-bus"><strong>Stop CAN Bus</strong></p>
<p>Stop the can bus by:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ ip link set can0 down
</pre></div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Display/DSS7.html" class="btn btn-neutral float-right" title="3.2.2.6. DSS" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Crypto.html" class="btn btn-neutral" title="3.2.2.4. Crypto" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2023</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'09_00_00',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });

        $('body').on("mousewheel", function () {
            // Remove default behavior
            event.preventDefault();
            // Scroll without smoothing
            var wheelDelta = event.wheelDelta;
            var currentScrollPosition = window.pageYOffset;
            window.scrollTo(0, currentScrollPosition - wheelDelta);
        });
      });
  </script>
   

</body>
</html>